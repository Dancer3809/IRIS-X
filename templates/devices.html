<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>IRIS-X - Система умный дом</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="IRIS-X Smart Home">
    <meta name="author" content="Nikolay Viguro">
    <meta itemprop="image" content="/static/ico/favicon.ico">

    <!-- Le styles -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <style type="text/css">
        body {
        padding-top: 60px;
        padding-bottom: 40px;
        }
        .sidebar-nav {
        padding: 9px 0;
        }
    </style>
    <link href="/static/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="/static/css/pnot.css" rel="stylesheet">

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="/static/ico/favicon.ico">

    <script src="/static/js/bootstrap.min.js"></script>
    <script src="/static/js/jquery.min.js"></script>
    <script src="/static/js/pnot.js"></script>

    <script type="text/javascript">
        $(document).ready(function()
        {

        var toggle = false;
        $.pnotify.defaults.history = false;

        function notifyAlert(type, title, message){
        $.pnotify({
        title: title,
        text: message,
        type: type,
        styling: 'bootstrap',
        });
        }


        $('#submit').click(function()
        {
        $('#formDevice').bind('submit',Foo());
        });

        function Foo () {

        if(toggle)
        {
        exit;
        }

        $('#submit').addClass("disabled");
        $('#submit').text("Отправляется");
        $('#submit').removeClass("btn-success");
        $('#submit').addClass("btn-danger");

        toggle = true;

        var key = document.getElementById('num').value;
        var keyType = "#type"+key;
        var type = $(keyType).html();
        var data_save = $('#formDevice').serializeArray();
        data_save.push({ name: "type", value: type });

        $.ajax({
        url: '/control/device',
        type: 'POST',
        data: data_save,
        dataType: 'html',
        success: function(html){
        $('#submit').removeClass("disabled");
        $('#submit').removeClass("btn-danger");
        $('#submit').addClass("btn-success");
        $('#submit').text("Отослать");
        notifyAlert('success', 'Готово', 'Значение выставлено!');
        toggle = false;
        },
        error: function(){
        $('#submit').removeClass("disabled");
        $('#submit').removeClass("btn-danger");
        $('#submit').addClass("btn-success");
        $('#submit').text("Отослать");
        notifyAlert('error', 'Ошибка', 'Что-то пошло не так :(');


        toggle = false;
        }
        });
        }
        });

    </script>
</head>

<body>

<div class="navbar navbar-inverse navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container-fluid">
            <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>
            <a class="brand" href="#">IRIS-X</a>

            <div class="nav-collapse collapse">
                <ul class="nav">
                    <li><a href="/">Главная</a></li>
                    <li><a href="/cams.html" class="active">Камеры</a></li>
                    <li><a href="/shedule.html">Расписание</a></li>
                    <li><a href="">Устройства</a></li>
                </ul>
            </div>
            <!--/.nav-collapse -->
        </div>
    </div>
</div>

<div class="container-fluid">
    <div class="row-fluid">
        <div class="span3">
            <div class="well sidebar-nav">
                <ul class="nav nav-list">
                    <li class="nav-header">Устройства</li>
                    <li class="active"><a href="#">Общие сведения</a></li>
                    <li><a href="#">Настройка</a></li>
                    <li><a href="#">Логи</a></li>
                </ul>
            </div>
            <!--/.well -->
        </div>
        <!--/span-->
        <div class="span9">
            <div class="row-fluid">

                <h2>Устройства</h2>

                <div class="span9">
                    <table class="table table-striped table-condensed">
                        <thead>
                        <tr>
                            <th>Название</th>
                            <th>Номер в сети</th>
                            <th>Тип устройства</th>
                            <th>Текущее значение</th>
                            <th>Статус</th>
                        </tr>
                        </thead>
                        <tbody>

                        #foreach( $key in [0..$iter])
                        #set ($type = $key+1)
                        <tr>
                            <td>$devicesList[$key][1]</td>
                            <td class="center">$devicesList[$key][2]</td>
                            <td class="center">
                                <div id="type$type">$devicesList[$key][4]</div>
                            </td>
                            <td class="center"><span class="badge">0</span></td>
                            <td class="center">
                                <span class="label label-success">в сети</span>
                            </td>
                        </tr>
                        #end


                        </tbody>
                    </table>

                </div>
            </div>
            <div class="row-fluid">

                <h2>Управление</h2>

                <div class="span9">
                    <table class="table table-striped table-condensed">

                        <tbody>
                        <tr>

                            <form id="formDevice" class="well form-inline">
                                <td>
                                    <input id="num" type="text" class="input-large" name="num"
                                           placeholder="Номер устройства">
                                </td>
                        </tr>
                        <tr>
                            <td>
                                <input id="value" type="text" class="input-large" name="value"
                                       placeholder="Значение">
                            </td>
                        </tr>
                        <td>
                            <a href="javascript:void(0);" class="btn btn-success" id="submit">Выполнить</a>
                        </td>
                        </tr>
                        </form>

                        </tbody>
                    </table>
                </div>
            </div>

            <!--/span-->
        </div>
        <!--/row-->

        <hr>

    </div>
    <!--/.fluid-container-->

    <!-- Le javascript
   ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

</body>
</html>
